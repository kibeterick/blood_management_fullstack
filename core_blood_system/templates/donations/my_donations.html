{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header">
            {% if is_admin_view %}
                <h4><i class="bi bi-file-earmark-text-fill"></i> All Donation Certificates</h4>
                <small class="text-white-50">View and manage all donation certificates in the system</small>
            {% else %}
                <h4><i class="bi bi-heart-pulse-fill"></i> My Donation History</h4>
            {% endif %}
        </div>
        <div class="card-body">
            {% if donations %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                {% if is_admin_view %}
                                    <th>Donor Name</th>
                                    <th>Contact</th>
                                {% endif %}
                                <th>Date</th>
                                <th>Blood Type</th>
                                <th>Units Donated</th>
                                <th>Hospital</th>
                                <th>Certificate</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for donation in donations %}
                            <tr>
                                {% if is_admin_view %}
                                    <td>
                                        <strong>{{ donation.donor.full_name }}</strong>
                                        {% if donation.donor.user %}
                                            <br><small class="text-muted">{{ donation.donor.user.username }}</small>
                                        {% else %}
                                            <br><small class="text-warning">No Account</small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <small>{{ donation.donor.phone }}</small><br>
                                        <small class="text-muted">{{ donation.donor.email }}</small>
                                    </td>
                                {% endif %}
                                <td>{{ donation.donation_date|date:"M d, Y" }}</td>
                                <td><span class="badge bg-danger">{{ donation.blood_type }}</span></td>
                                <td>{{ donation.units_donated }}</td>
                                <td>{{ donation.hospital_name }}</td>
                                <td>
                                    <a href="{% url 'download_certificate' donation.id %}" 
                                       class="btn btn-sm btn-primary">
                                        <i class="bi bi-download"></i> Download
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="alert alert-success mt-3">
                    {% if is_admin_view %}
                        <h6><i class="bi bi-graph-up-arrow"></i> System Statistics:</h6>
                        <p class="mb-0">
                            Total donations recorded: <strong>{{ donations.count }}</strong><br>
                            Total units collected: <strong>{{ total_units }}</strong> unit(s)<br>
                            Potential lives saved: <strong>{{ total_units|add:"0"|add:"0"|add:"0" }}</strong> lives ðŸŽ‰
                        </p>
                    {% else %}
                        <h6><i class="bi bi-trophy-fill"></i> Your Impact:</h6>
                        <p class="mb-0">
                            You have donated <strong>{{ total_units }}</strong> unit(s) of blood across 
                            <strong>{{ donations.count }}</strong> donation(s). 
                            Each unit can save up to 3 lives - you've potentially saved 
                            <strong>{{ total_units|add:"0"|add:"0"|add:"0" }}</strong> lives! ðŸŽ‰
                        </p>
                    {% endif %}
                </div>
            {% else %}
                <div class="alert alert-info">
                    {% if is_admin_view %}
                        <h5><i class="bi bi-info-circle"></i> No Donations Recorded</h5>
                        <p>No blood donations have been recorded in the system yet.</p>
                    {% else %}
                        <h5><i class="bi bi-info-circle"></i> No Donations Yet</h5>
                        <p>You haven't made any blood donations yet. When you donate, your certificates will appear here.</p>
                        <a href="{% url 'register_donor' %}" class="btn btn-primary">Register as Donor</a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
