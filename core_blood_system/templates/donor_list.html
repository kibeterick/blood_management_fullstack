{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-success text-white">
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-0">ðŸ©¸ Donor List</h4>
                <div>
                    <div class="btn-group me-2" role="group">
                        <a href="{% url 'export_donors_excel' %}" class="btn btn-light btn-sm">
                            ðŸ“Š Export Excel
                        </a>
                        <a href="{% url 'export_donors_pdf' %}" class="btn btn-light btn-sm">
                            ðŸ“„ Export PDF
                        </a>
                    </div>
                    <a href="{% url 'register_donor' %}" class="btn btn-warning">+ Register New Donor</a>
                </div>
            </div>
        </div>
        <div class="card-body">
            <!-- Search and Filter Section -->
            <form method="GET" class="row g-3 mb-4">
                <div class="col-md-4">
                    <input type="text" name="search" class="form-control" placeholder="Search by name, email, phone..." value="{{ search_query }}">
                </div>
                <div class="col-md-3">
                    <select name="blood_type" class="form-select">
                        <option value="">All Blood Types</option>
                        <option value="A+" {% if blood_type_filter == 'A+' %}selected{% endif %}>A+</option>
                        <option value="A-" {% if blood_type_filter == 'A-' %}selected{% endif %}>A-</option>
                        <option value="B+" {% if blood_type_filter == 'B+' %}selected{% endif %}>B+</option>
                        <option value="B-" {% if blood_type_filter == 'B-' %}selected{% endif %}>B-</option>
                        <option value="AB+" {% if blood_type_filter == 'AB+' %}selected{% endif %}>AB+</option>
                        <option value="AB-" {% if blood_type_filter == 'AB-' %}selected{% endif %}>AB-</option>
                        <option value="O+" {% if blood_type_filter == 'O+' %}selected{% endif %}>O+</option>
                        <option value="O-" {% if blood_type_filter == 'O-' %}selected{% endif %}>O-</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select name="availability" class="form-select">
                        <option value="">All Status</option>
                        <option value="available" {% if availability_filter == 'available' %}selected{% endif %}>Available</option>
                        <option value="unavailable" {% if availability_filter == 'unavailable' %}selected{% endif %}>Unavailable</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">Filter</button>
                </div>
            </form>

            <!-- Donor Table -->
            {% if donors %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>#</th>
                                <th>Full Name</th>
                                <th>Blood Type</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>City</th>
                                <th>Last Donation</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for donor in donors %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <strong>{{ donor.first_name }} {{ donor.last_name }}</strong>
                                </td>
                                <td>
                                    <span class="badge bg-danger">{{ donor.blood_type }}</span>
                                </td>
                                <td>{{ donor.email }}</td>
                                <td>{{ donor.phone_number }}</td>
                                <td>{{ donor.city }}</td>
                                <td>
                                    {% if donor.last_donation_date %}
                                        {{ donor.last_donation_date|date:"M d, Y" }}
                                    {% else %}
                                        <span class="text-muted">Never</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if donor.is_available %}
                                        <span class="badge bg-success">Available</span>
                                    {% else %}
                                        <span class="badge bg-warning">Unavailable</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'delete_donor' donor.pk %}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this donor?')">Delete</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="alert alert-info">
                    <strong>Total Donors:</strong> {{ donors|length }}
                </div>
            {% else %}
                <div class="alert alert-warning text-center">
                    <h5>No donors found</h5>
                    <p>No donors match your search criteria or no donors have been registered yet.</p>
                    <a href="{% url 'register_donor' %}" class="btn btn-primary">Register First Donor</a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}