{% extends 'base.html' %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Admin Dashboard</h2>
    <div>
      <a href="/stock-report/" class="btn btn-warning me-2">ðŸ“‹ Report</a>
      <a href="/export-donors/" class="btn btn-success">ðŸ“Š Export</a>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-8">
      <div class="card shadow-sm"><div class="card-body"><canvas id="inventoryChart" height="100"></canvas></div></div>
    </div>
    <div class="col-md-4">
      <div class="card bg-danger text-white shadow-sm h-100">
        <div class="card-body text-center d-flex flex-column justify-content-center">
          <h5>Pending Requests</h5><h2>{{ total_requests }}</h2>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-header bg-dark text-white">Inventory</div>
    <div class="card-body"><div class="row">
      {% for item in stock %}
      <div class="col-md-3 mb-2">
        <div class="p-2 border rounded text-center">
          <h5>{{ item.blood_group }}</h5>
          <small class="text-muted">Updated: {{ item.last_updated|date:"H:i" }}</small>
          <form method="POST">{% csrf_token %}<input type="hidden" name="stock_id" value="{{ item.id }}"><input type="number" name="bags" value="{{ item.bags }}" class="form-control form-control-sm mb-1"><button type="submit" class="btn btn-sm btn-success w-100">Update</button></form>
        </div>
      </div>
      {% endfor %}
    </div></div>
  </div>

  <script>
    new Chart(document.getElementById('inventoryChart'), {
      type: 'bar',
      data: {
        labels: {{ chart_labels|safe }},
        datasets: [{ label: 'Bags', data: {{ chart_data|safe }}, backgroundColor: '#dc3545' }]
      }
    });
  </script>
</div>
{% endblock %}
